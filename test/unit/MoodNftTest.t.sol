// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

import {Test} from "forge-std/Test.sol";
import {MoodNft} from "../../src/MoodNft.sol";
import {console} from "forge-std/console.sol";
import {DeployMoodNft} from "../../script/DeployMoodNft.s.sol";
import {Base64} from "@openzeppelin/contracts/utils/Base64.sol";

contract MoodNftTest is Test {
    address private constant USER = address(1);
    string public constant HAPPY_SVG_URI =
        "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMjAgMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmMGYwZjA7IGltYWdlLXJlbmRlcmluZzogcGl4ZWxhdGVkOyI+DQogIDwhLS0gDQogICAgUGl4ZWwgQXJ0IFNtaWxpbmcgTWFuDQogICAgRWFjaCByZWN0IHJlcHJlc2VudHMgb25lICJwaXhlbCIgb24gYSAyMHgyMCBncmlkLg0KICAtLT4NCg0KICA8IS0tIEhhaXIgKERhcmsgQnJvd246ICM0YTJhMTUpIC0tPg0KICA8cmVjdCB4PSI2IiB5PSIyIiB3aWR0aD0iOCIgaGVpZ2h0PSIxIiBmaWxsPSIjNGEyYTE1Ii8+DQogIDxyZWN0IHg9IjUiIHk9IjMiIHdpZHRoPSIxMCIgaGVpZ2h0PSIxIiBmaWxsPSIjNGEyYTE1Ii8+DQogIDxyZWN0IHg9IjUiIHk9IjQiIHdpZHRoPSIxIiBoZWlnaHQ9IjIiIGZpbGw9IiM0YTJhMTUiLz4NCiAgPHJlY3QgeD0iMTQiIHk9IjQiIHdpZHRoPSIxIiBoZWlnaHQ9IjIiIGZpbGw9IiM0YTJhMTUiLz4NCiAgDQogIDwhLS0gRmFjZSAoU2tpbiBUb25lOiAjZjJkMmI2KSAtLT4NCiAgPHJlY3QgeD0iNiIgeT0iNCIgd2lkdGg9IjgiIGhlaWdodD0iNiIgZmlsbD0iI2YyZDJiNiIvPg0KICA8cmVjdCB4PSI1IiB5PSI1IiB3aWR0aD0iMSIgaGVpZ2h0PSI0IiBmaWxsPSIjZjJkMmI2Ii8+DQogIDxyZWN0IHg9IjE0IiB5PSI1IiB3aWR0aD0iMSIgaGVpZ2h0PSI0IiBmaWxsPSIjZjJkMmI2Ii8+DQoNCiAgPCEtLSBFeWVzIChCbGFjazogIzAwMDAwMCkgLS0+DQogIDxyZWN0IHg9IjgiIHk9IjYiIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGZpbGw9IiMwMDAwMDAiLz4NCiAgPHJlY3QgeD0iMTEiIHk9IjYiIHdpZHRoPSIxIiBoZWlnaHQ9IjEiIGZpbGw9IiMwMDAwMDAiLz4NCg0KICA8IS0tIFNtaWxlIChCbGFjazogIzAwMDAwMCkgLS0+DQogIDxyZWN0IHg9IjgiIHk9IjgiIHdpZHRoPSI0IiBoZWlnaHQ9IjEiIGZpbGw9IiMwMDAwMDAiLz4NCiAgPHJlY3QgeD0iNyIgeT0iNyIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0iIzAwMDAwMCIvPg0KICA8cmVjdCB4PSIxMiIgeT0iNyIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0iIzAwMDAwMCIvPg0KDQogIDwhLS0gU2hpcnQgKEJsdWU6ICMzYTVjYzQpIC0tPg0KICA8cmVjdCB4PSI1IiB5PSIxMCIgd2lkdGg9IjEwIiBoZWlnaHQ9IjQiIGZpbGw9IiMzYTVjYzQiLz4NCiAgPHJlY3QgeD0iNCIgeT0iMTEiIHdpZHRoPSIxIiBoZWlnaHQ9IjMiIGZpbGw9IiMzYTVjYzQiLz4NCiAgPHJlY3QgeD0iMTUiIHk9IjExIiB3aWR0aD0iMSIgaGVpZ2h0PSIzIiBmaWxsPSIjM2E1Y2M0Ii8+DQoNCiAgPCEtLSBOZWNrIC0tPg0KICA8cmVjdCB4PSI5IiB5PSIxMCIgd2lkdGg9IjIiIGhlaWdodD0iMSIgZmlsbD0iI2YyZDJiNiIvPg0KDQo8L3N2Zz4NCg==";
    string public constant SAD_SVG_URI =
        "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB2aWV3Qm94PSIwIDAgMjAgMjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNmMGYwZjA7IGltYWdlLXJlbmRlcmluZzogcGl4ZWxhdGVkOyI+DQogIDwhLS0gDQogICAgUGl4ZWwgQXJ0IFNhZCBNYW4NCiAgICBFYWNoIHJlY3QgcmVwcmVzZW50cyBvbmUgInBpeGVsIiBvbiBhIDIweDIwIGdyaWQuDQogIC0tPg0KDQogIDwhLS0gSGFpciAoRGFyayBCcm93bjogIzRhMmExNSkgLS0+DQogIDxyZWN0IHg9IjYiIHk9IjIiIHdpZHRoPSI4IiBoZWlnaHQ9IjEiIGZpbGw9IiM0YTJhMTUiLz4NCiAgPHJlY3QgeD0iNSIgeT0iMyIgd2lkdGg9IjEwIiBoZWlnaHQ9IjEiIGZpbGw9IiM0YTJhMTUiLz4NCiAgPHJlY3QgeD0iNSIgeT0iNCIgd2lkdGg9IjEiIGhlaWdodD0iMiIgZmlsbD0iIzRhMmExNSIvPg0KICA8cmVjdCB4PSIxNCIgeT0iNCIgd2lkdGg9IjEiIGhlaWdodD0iMiIgZmlsbD0iIzRhMmExNSIvPg0KICANCiAgPCEtLSBGYWNlIChTa2luIFRvbmU6ICNmMmQyYjYpIC0tPg0KICA8cmVjdCB4PSI2IiB5PSI0IiB3aWR0aD0iOCIgaGVpZ2h0PSI2IiBmaWxsPSIjZjJkMmI2Ii8+DQogIDxyZWN0IHg9IjUiIHk9IjUiIHdpZHRoPSIxIiBoZWlnaHQ9IjQiIGZpbGw9IiNmMmQyYjYiLz4NCiAgPHJlY3QgeD0iMTQiIHk9IjUiIHdpZHRoPSIxIiBoZWlnaHQ9IjQiIGZpbGw9IiNmMmQyYjYiLz4NCg0KICA8IS0tIEV5ZXMgKEJsYWNrOiAjMDAwMDAwKSAtLT4NCiAgPHJlY3QgeD0iOCIgeT0iNiIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0iIzAwMDAwMCIvPg0KICA8cmVjdCB4PSIxMSIgeT0iNiIgd2lkdGg9IjEiIGhlaWdodD0iMSIgZmlsbD0iIzAwMDAwMCIvPg0KDQogIDwhLS0gRnJvd24gKEJsYWNrOiAjMDAwMDAwKSAtLT4NCiAgPHJlY3QgeD0iOCIgeT0iOCIgd2lkdGg9IjQiIGhlaWdodD0iMSIgZmlsbD0iIzAwMDAwMCIvPg0KICA8cmVjdCB4PSI3IiB5PSI5IiB3aWR0aD0iMSIgaGVpZ2h0PSIxIiBmaWxsPSIjMDAwMDAwIi8+DQogIDxyZWN0IHg9IjEyIiB5PSI5IiB3aWR0aD0iMSIgaGVpZ2h0PSIxIiBmaWxsPSIjMDAwMDAwIi8+DQoNCiAgPCEtLSBTaGlydCAoQmx1ZTogIzNhNWNjNCkgLS0+DQogIDxyZWN0IHg9IjUiIHk9IjEwIiB3aWR0aD0iMTAiIGhlaWdodD0iNCIgZmlsbD0iIzNhNWNjNCIvPg0KICA8cmVjdCB4PSI0IiB5PSIxMSIgd2lkdGg9IjEiIGhlaWdodD0iMyIgZmlsbD0iIzNhNWNjNCIvPg0KICA8cmVjdCB4PSIxNSIgeT0iMTEiIHdpZHRoPSIxIiBoZWlnaHQ9IjMiIGZpbGw9IiMzYTVjYzQiLz4NCg0KICA8IS0tIE5lY2sgLS0+DQogIDxyZWN0IHg9IjkiIHk9IjEwIiB3aWR0aD0iMiIgaGVpZ2h0PSIxIiBmaWxsPSIjZjJkMmI2Ii8+DQoNCjwvc3ZnPg0K";
    // string public constant SAD_DATA =
    //     "data:application/json;base64,eyJuYW1lIjoiTW9vZE5GVCIsICJkZXNjcmlwdGlvbiI6IkEgbW9vZCBORlQiLCAiYXR0cmlidXRlcyI6IFt7InRyYWl0X3R5cGUiOiAibW9vZGluZXNzIiwgInZhbHVlIjogIjEwMCIifV0sICJpbWFnZSI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjNhV1IwYUQwaU1UQXdKU0lnYUdWcFoyaDBQU0l4TURBbElpQjJhV1YzUW05NFBTSXdJREFnTWpBZ01qQWlJSGh0Ykc1elBTSm9kSFJ3T2k4dmQzZDNMbmN6TG05eVp5OHlNREF3TDNOMlp5SWdjM1I1YkdVOUltSmhZMnRuY205MWJtUXRZMjlzYjNJNklDTm1NR1l3WmpBN0lHbHRZV2RsTFhKbGJtUmxjbWx1WnpvZ2NHbDRaV3hoZEdWa095SStEUW9nSUR3aExTMGdEUW9nSUNBZ1VHbDRaV3dnUVhKMElGTnRhV3hwYm1jZ1RXRnVEUW9nSUNBZ1JXRmphQ0J5WldOMElISmxjSEpsYzJWdWRITWdiMjVsSUNKd2FYaGxiQ0lnYjI0Z1lTQXlNSGd5TUNCbmNtbGtMZzBLSUNBdExUNE5DZzBLSUNBOElTMHRJRWhoYVhJZ0tFUmhjbXNnUW5KdmQyNDZJQ00wWVRKaE1UVXBJQzB0UGcwS0lDQThjbVZqZENCNFBTSTJJaUI1UFNJeUlpQjNhV1IwYUQwaU9DSWdhR1ZwWjJoMFBTSXhJaUJtYVd4c1BTSWpOR0V5WVRFMUlpOCtEUW9nSUR4eVpXTjBJSGc5SWpVaUlIazlJak1pSUhkcFpIUm9QU0l4TUNJZ2FHVnBaMmgwUFNJeElpQm1hV3hzUFNJak5HRXlZVEUxSWk4K0RRb2dJRHh5WldOMElIZzlJalVpSUhrOUlqUWlJSGRwWkhSb1BTSXhJaUJvWldsbmFIUTlJaklpSUdacGJHdzlJaU0wWVRKaE1UVWlMejROQ2lBZ1BISmxZM1FnZUQwaU1UUWlJSGs5SWpRaUlIZHBaSFJvUFNJeElpQm9aV2xuYUhROUlqSWlJR1pwYkd3OUlpTTBZVEpoTVRVaUx6NE5DaUFnRFFvZ0lEd2hMUzBnUm1GalpTQW9VMnRwYmlCVWIyNWxPaUFqWmpKa01tSTJLU0F0TFQ0TkNpQWdQSEpsWTNRZ2VEMGlOaUlnZVQwaU5DSWdkMmxrZEdnOUlqZ2lJR2hsYVdkb2REMGlOaUlnWm1sc2JEMGlJMll5WkRKaU5pSXZQZzBLSUNBOGNtVmpkQ0I0UFNJMUlpQjVQU0kxSWlCM2FXUjBhRDBpTVNJZ2FHVnBaMmgwUFNJMElpQm1hV3hzUFNJalpqSmtNbUkySWk4K0RRb2dJRHh5WldOMElIZzlJakUwSWlCNVBTSTFJaUIzYVdSMGFEMGlNU0lnYUdWcFoyaDBQU0kwSWlCbWFXeHNQU0lqWmpKa01tSTJJaTgrRFFvTkNpQWdQQ0V0TFNCRmVXVnpJQ2hDYkdGamF6b2dJekF3TURBd01Da2dMUzArRFFvZ0lEeHlaV04wSUhnOUlqZ2lJSGs5SWpZaUlIZHBaSFJvUFNJeElpQm9aV2xuYUhROUlqRWlJR1pwYkd3OUlpTXdNREF3TURBaUx6NE5DaUFnUEhKbFkzUWdlRDBpTVRFaUlIazlJallpSUhkcFpIUm9QU0l4SWlCb1pXbG5hSFE5SWpFaUlHWnBiR3c5SWlNd01EQXdNREFpTHo0TkNnMEtJQ0E4SVMwdElGTnRhV3hsSUNoQ2JHRmphem9nSXpBd01EQXdNQ2tnTFMwK0RRb2dJRHh5WldOMElIZzlJamdpSUhrOUlqZ2lJSGRwWkhSb1BTSTBJaUJvWldsbmFIUTlJakVpSUdacGJHdzlJaU13TURBd01EQWlMejROQ2lBZ1BISmxZM1FnZUQwaU55SWdlVDBpTnlJZ2QybGtkR2c5SWpFaUlHaGxhV2RvZEQwaU1TSWdabWxzYkQwaUl6QXdNREF3TUNJdlBnMEtJQ0E4Y21WamRDQjRQU0l4TWlJZ2VUMGlOeUlnZDJsa2RHZzlJakVpSUdobGFXZG9kRDBpTVNJZ1ptbHNiRDBpSXpBd01EQXdNQ0l2UGcwS0RRb2dJRHdoTFMwZ1UyaHBjblFnS0VKc2RXVTZJQ016WVRWall6UXBJQzB0UGcwS0lDQThjbVZqZENCNFBTSTFJaUI1UFNJeE1DSWdkMmxrZEdnOUlqRXdJaUJvWldsbmFIUTlJalFpSUdacGJHdzlJaU16WVRWall6UWlMejROQ2lBZ1BISmxZM1FnZUQwaU5DSWdlVDBpTVRFaUlIZHBaSFJvUFNJeElpQm9aV2xuYUhROUlqTWlJR1pwYkd3OUlpTXpZVFZqWXpRaUx6NE5DaUFnUEhKbFkzUWdlRDBpTVRVaUlIazlJakV4SWlCM2FXUjBhRDBpTVNJZ2FHVnBaMmgwUFNJeklpQm1hV3hzUFNJak0yRTFZMk0wSWk4K0RRb05DaUFnUENFdExTQk9aV05ySUMwdFBnMEtJQ0E4Y21WamRDQjRQU0k1SWlCNVBTSXhNQ0lnZDJsa2RHZzlJaklpSUdobGFXZG9kRDBpTVNJZ1ptbHNiRDBpSTJZeVpESmlOaUl2UGcwS0RRbzhMM04yWno0TkNnPT0ifQ==";
    MoodNft moodNft;

    function setUp() public {
        moodNft = new MoodNft(SAD_SVG_URI, HAPPY_SVG_URI);
    }

    function testViewTokenURI() public {
        vm.prank(USER);
        moodNft.mintNft();
        console.log(moodNft.tokenURI(0));
    }

    function testFlipMood() public {
        vm.prank(USER);
        moodNft.mintNft();

        vm.prank(USER);
        moodNft.flipMood(0);

        string memory expectedHappyUri = string(
            abi.encodePacked(
                "data:application/json;base64,",
                Base64.encode(
                    bytes(
                        abi.encodePacked(
                            '{"name":"',
                            moodNft.name(),
                            '", "description":"A mood NFT", "attributes": [{"trait_type": "moodiness", "value": "100"}], "image":"',
                            HAPPY_SVG_URI,
                            '"}'
                        )
                    )
                )
            )
        );

        assertEq(moodNft.tokenURI(0), expectedHappyUri);
    }
}
